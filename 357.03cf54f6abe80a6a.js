"use strict";(self.webpackChunkpvida_backoffice_web=self.webpackChunkpvida_backoffice_web||[]).push([[357],{8357:($,L,l)=>{l.r(L),l.d(L,{AuthModule:()=>_});var h=l(6814),u=l(8425),p=l(5861),o=l(95),d=l(9849),e=l(6689),f=l(2186),g=l(553),S=l(9862);function T(r){this.message=r}(T.prototype=new Error).name="InvalidCharacterError";var A=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(r){var s=String(r).replace(/=+$/,"");if(s.length%4==1)throw new T("'atob' failed: The string to be decoded is not correctly encoded.");for(var c,t,n=0,a=0,i="";t=s.charAt(a++);~t&&(c=n%4?64*c+t:t,n++%4)?i+=String.fromCharCode(255&c>>(-2*n&6)):0)t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t);return i};function v(r){this.message=r}(v.prototype=new Error).name="InvalidTokenError";var x=l(7398),P=l(6306),C=l(708),Z=l(2096),N=l(593),y=l(677);let w=(()=>{var r;class s{constructor(t,n,a){this.http=t,this.authDataService=n,this.notificationService=a,this.responseEnum=d.T.DEFAULT}login(t){var n=this;return(0,p.Z)(function*(){let a=yield n.http.post(`${g.N.apiURL}authoperation/login`,t).pipe((0,x.U)(i=>n.handleResultLogin(i)),(0,P.K)(n.handleError("login",[])));return(0,C.n)(a)})()}resetPassword(t){var n=this;return(0,p.Z)(function*(){const a=n.authDataService.getUserToken(),i=new S.WM({"Access-Control-Allow-Methods":"GET,POST,OPTIONS,DELETE,PUT",Authorization:"Bearer "+a});let m=yield n.http.put(`${g.N.apiURL}authoperation/reset-password-and-clean-actions`,t,{headers:i}).pipe((0,x.U)(U=>n.handleResultLogin(U)),(0,P.K)(n.handleError("reset-password",[])));return(0,C.n)(m)})()}recoverPassword(t){var n=this;return(0,p.Z)(function*(){const a=n.authDataService.getUserToken(),i=new S.WM({"Access-Control-Allow-Methods":"GET,POST,OPTIONS,DELETE,PUT",Authorization:"Bearer "+a,accept:"*/*","Content-Type":"application/json"});let m=yield n.http.post(`${g.N.apiURL}authoperation/recuperar-password`,t,{headers:i}).pipe((0,x.U)(U=>n.handleResult(U)),(0,P.K)(n.handleError("recover-password",[])));return(0,C.n)(m)})()}logOut(){this.authDataService.cleanAll()}handleResultLogin(t){const n=function b(r,s){if("string"!=typeof r)throw new v("Invalid token specified");var c=!0===(s=s||{}).header?0:1;try{return JSON.parse(function F(r){var s=r.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(A(s).replace(/(.)/g,function(t,n){var a=n.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}catch{return A(s)}}(r.split(".")[c]))}catch(t){throw new v("Invalid token specified: "+t.message)}}(t?.accessToken);return this.authDataService.setUserToken(t?.accessToken),this.authDataService.setUserRefreshToken(t?.refreshToken),this.authDataService.setIsFirstAcess(t?.isFirstAcess),this.authDataService.setUserProfile(t?.profile),this.authDataService.setUserId(t?.userID),this.authDataService.setUserName(n?.given_name),this.authDataService.setUserEmail(n?.email),{data:t,responseEnum:d.T.SUCCESS}}handleResult(t){return{data:t,responseEnum:d.T.SUCCESS}}handleError(t="operation",n){return a=>{const i=new N.C(d.T.DEFAULT,null);switch(i.responseMsg=a.error&&a.error.Message?a.error.Message:"N\xe3o foi poss\xedvel realizar a opera\xe7\xe3o, tente novamente!",i.responseEnum=a.status,a.status){case 400:case 500:i.responseMsg="Utilizador sem acesso, consulte o administrador do sistema!";break;case 401:i.responseMsg="Utilizador ou Palavra-Passe incorrecto, verifique e volte a tentar!";break;default:i.responseMsg="Houve um erro ao processar o Pedido, por favor tente novamente!"}return this.notificationService.error(i.responseMsg),(0,Z.of)(i)}}}return(r=s).\u0275fac=function(t){return new(t||r)(e.LFG(S.eN),e.LFG(y.p),e.LFG(f.g))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),s})();var E=l(5799);function k(r,s){1&r&&e._UZ(0,"i",8)}const M=function(){return["/auth/","recuperar-senha"]};function D(r,s){1&r&&e._UZ(0,"i",9)}const O=function(){return["/auth"]};function Y(r,s){1&r&&(e.TgZ(0,"span",8),e._uU(1," Palavra-Passe deve ter no m\xednimo 8 caracteres, e pelo menos 1 n\xfamero e 1 s\xedmbolo. "),e.qZA())}function z(r,s){1&r&&(e.TgZ(0,"span",8),e._uU(1," Palavra-Passe deve ter no m\xednimo 8 caracteres, e pelo menos 1 n\xfamero e 1 s\xedmbolo. "),e.qZA())}function j(r,s){1&r&&e._UZ(0,"i",9)}const B=[{path:"",component:(()=>{var r;class s{constructor(t,n,a,i){this.router=t,this.notificationService=n,this.authService=a,this.dataService=i,this.isLoading=!1,this.loginForm=new o.cw({}),this.responseEnum=d.T.SUCCESS}ngOnInit(){this.dataService.cleanAll(),this.loginForm=new o.cw({userName:new o.NI(null,[o.kI.required]),password:new o.NI(null,[o.kI.required])})}login(){var t=this;return(0,p.Z)(function*(){if(t.loginForm.invalid)return void t.notificationService.warning("Obrigat\xf3rio preencher todos os campos!");t.isLoading=!0;const n={userName:t.loginForm.value.userName,password:t.loginForm.value.password};let a=yield t.authService.login(n);a.responseEnum==d.T.SUCCESS?(t.isLoading=!1,a.data.isFirstAcess?t.router.navigateByUrl("/auth/mudar-senha?tk="+a.data.accessToken+"&userId="+a.data.userID+"&email="+n.userName):(t.notificationService.success("Bem-vindo ao Sistema BackOffice da Prova de Vida da ENSA!"),t.router.navigateByUrl("/"))):(t.isLoading=!1,t.notificationService.error(a.responseMsg))})()}}return(r=s).\u0275fac=function(t){return new(t||r)(e.Y36(u.F0),e.Y36(f.g),e.Y36(w),e.Y36(y.p))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-login"]],decls:12,vars:6,consts:[[1,"flex","flex-col","h-full","justify-center","items-center"],[1,"text-2xl","font-bold","text-gray-700","mb-[10%]"],[1,"text-sm","flex","flex-col","items-center",3,"formGroup"],["type","text","formControlName","userName","id","user","autocomplete","off","name","user","placeholder","Digite o seu e-mail",1,"input-auth"],["formControlName","password",1,"mt-8"],[1,"self-end","text-accent","text-sm","font-medium","mt-3",3,"routerLink"],["type","submit",1,"mt-6","btn-auth","flex","items-center","space-x-2",3,"disabled","click"],["class","icon-loading animate-spin text-white",4,"ngIf"],[1,"icon-loading","animate-spin","text-white"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2,"Login de Utilizador"),e.qZA(),e.TgZ(3,"form",2),e._UZ(4,"input",3)(5,"app-input-password",4),e.TgZ(6,"a",5),e._uU(7,"Esqueceu a sua palavra-passe ?"),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return n.login()}),e.YNc(9,k,1,0,"i",7),e.TgZ(10,"span"),e._uU(11),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("formGroup",n.loginForm),e.xp6(3),e.Q6J("routerLink",e.DdM(5,M)),e.xp6(2),e.Q6J("disabled",n.isLoading),e.xp6(1),e.Q6J("ngIf",n.isLoading),e.xp6(2),e.hij(" ",n.isLoading?"Acedendo":"Aceder"," "))},dependencies:[h.O5,u.rH,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,E.P]}),s})()},{path:"recuperar-senha",component:(()=>{var r;class s{constructor(t,n,a){this.notificationService=t,this.authService=n,this.router=a,this.recoverForm=new o.cw({}),this.isLoading=!1}ngOnInit(){this.recoverForm=new o.cw({email:new o.NI(null,[o.kI.required,o.kI.pattern("^[\\w.-]+@([\\w-]+\\.)+[\\w-]{2,}$")])})}onSubmit(){var t=this;return(0,p.Z)(function*(){if(t.recoverForm.invalid)return void t.notificationService.warning("E-mail informado inv\xe1lido!");t.isLoading=!0;const n={email:t.recoverForm.value.email,urlSite:g.N.urlSite+"/auth/mudar-senha"};(yield t.authService.recoverPassword(n)).responseEnum==d.T.SUCCESS&&(t.notificationService.success("Link de Recupera\xe7\xe3o de Palavra-Passe enviado, por favor verifique a caixa de e-mail!"),t.router.navigateByUrl("/auth")),t.isLoading=!1})()}}return(r=s).\u0275fac=function(t){return new(t||r)(e.Y36(f.g),e.Y36(w),e.Y36(u.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-recuperar-senha"]],decls:14,vars:6,consts:[[1,"h-full","w-full","grelha"],[1,"text-base","text-gray-700","flex","space-x-3","items-center","font-semibold",3,"routerLink"],[1,"icon-arrow-left"],[1,"flex","flex-col","items-center","justify-center","mb-[20%]"],[1,"text-2xl","font-bold","text-gray-700","mb-[10%]"],[1,"text-sm","flex","flex-col","items-center",3,"formGroup"],["type","text","formControlName","email","id","user","autocomplete","off","name","email","placeholder","Digite o seu e-mail",1,"input-auth"],["type","submit",1,"mt-6","btn-auth","flex","items-center","space-x-2",3,"disabled","click"],["class","icon-loading animate-spin text-white",4,"ngIf"],[1,"icon-loading","animate-spin","text-white"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"a",1),e._UZ(2,"i",2),e.TgZ(3,"span"),e._uU(4,"Voltar para login"),e.qZA()(),e.TgZ(5,"section",3)(6,"h1",4),e._uU(7,"Recupera\xe7\xe3o de Palavra-passe"),e.qZA(),e.TgZ(8,"form",5),e._UZ(9,"input",6),e.TgZ(10,"button",7),e.NdJ("click",function(){return n.onSubmit()}),e.YNc(11,D,1,0,"i",8),e.TgZ(12,"span"),e._uU(13),e.qZA()()()()()),2&t&&(e.xp6(1),e.Q6J("routerLink",e.DdM(5,O)),e.xp6(7),e.Q6J("formGroup",n.recoverForm),e.xp6(2),e.Q6J("disabled",n.isLoading),e.xp6(1),e.Q6J("ngIf",n.isLoading),e.xp6(2),e.hij(" ",n.isLoading?"Enviando":"Enviar"," "))},dependencies:[h.O5,u.rH,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u],styles:[".grelha[_ngcontent-%COMP%]{display:grid;grid-template-rows:5% 1fr;grid-template-columns:repeat(1,minmax(0,1fr))}"]}),s})()},{path:"mudar-senha",component:(()=>{var r;class s{constructor(t,n,a,i,m){this.router=t,this.notificationService=n,this.authService=a,this.dataService=i,this.route=m,this.isLoading=!1,this.changePasswordForm=new o.cw({}),this.typeNew="password",this.typeConfirm="password",this.changePasswordForm=new o.cw({newPassword:new o.NI(null,[o.kI.required,o.kI.pattern("^(?=.*[0-9])(?=.*[^a-zA-Z0-9]).{8,}$")]),confirmPassword:new o.NI(null,[o.kI.required,o.kI.pattern("^(?=.*[0-9])(?=.*[^a-zA-Z0-9]).{8,}$")])})}ngOnInit(){this.routeSubscription=this.route.queryParams.subscribe(t=>{this.tk=t.tk,this.email=t.email,this.userId=t.userId})}ngOnDestroy(){this.routeSubscription?.unsubscribe()}onSubmit(){var t=this;return(0,p.Z)(function*(){if(t.changePasswordForm.value.newPassword&&t.changePasswordForm.value.confirmPassword){if(!t.changePasswordForm.invalid)if(t.changePasswordForm.value.newPassword===t.changePasswordForm.value.confirmPassword){t.isLoading=!0,t.dataService.setUserToken(t.tk);const n={userId:t.userId,email:t.email,novaPalavraPasse:t.changePasswordForm.value.newPassword},a=yield t.authService.resetPassword(n);a.responseEnum==d.T.SUCCESS?(t.isLoading=!1,t.notificationService.success("Bem-vindo ao Sistema BackOffice da Prova de Vida da ENSA!"),t.router.navigateByUrl("/")):(t.isLoading=!1,t.notificationService.error(a.responseMsg))}else t.notificationService.warning("Palavras-Passe n\xe3o coincidem")}else t.notificationService.warning("Obrigat\xf3rio preencher todos os campos!")})()}}return(r=s).\u0275fac=function(t){return new(t||r)(e.Y36(u.F0),e.Y36(f.g),e.Y36(w),e.Y36(y.p),e.Y36(u.gz))},r.\u0275cmp=e.Xpm({type:r,selectors:[["ng-component"]],decls:12,vars:6,consts:[[1,"flex","flex-col","h-full","justify-center","items-center"],[1,"text-2xl","font-bold","text-gray-700","mb-[10%]"],[1,"text-sm","flex","flex-col","items-start",3,"formGroup"],["formControlName","newPassword","placeholder","Nova Palavra-passe",1,""],["class","text-red-600 text-xs pt-1 max-w-sm",4,"ngIf"],["formControlName","confirmPassword","placeholder","Confirmar Palavra-passe",1,"mt-8"],["type","submit",1,"mt-6","btn-auth","flex","items-center","space-x-2",3,"disabled","click"],["class","icon-loading animate-spin text-white",4,"ngIf"],[1,"text-red-600","text-xs","pt-1","max-w-sm"],[1,"icon-loading","animate-spin","text-white"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2,"Mudar a palavra-passe"),e.qZA(),e.TgZ(3,"form",2),e._UZ(4,"app-input-password",3),e.YNc(5,Y,2,0,"span",4),e._UZ(6,"app-input-password",5),e.YNc(7,z,2,0,"span",4),e.TgZ(8,"button",6),e.NdJ("click",function(){return n.onSubmit()}),e.YNc(9,j,1,0,"i",7),e.TgZ(10,"span"),e._uU(11),e.qZA()()()()),2&t){let a,i;e.xp6(3),e.Q6J("formGroup",n.changePasswordForm),e.xp6(2),e.Q6J("ngIf",(null==(a=n.changePasswordForm.get("newPassword"))?null:a.invalid)&&(null==(a=n.changePasswordForm.get("newPassword"))?null:a.dirty)),e.xp6(2),e.Q6J("ngIf",(null==(i=n.changePasswordForm.get("confirmPassword"))?null:i.invalid)&&(null==(i=n.changePasswordForm.get("confirmPassword"))?null:i.dirty)),e.xp6(1),e.Q6J("disabled",n.isLoading),e.xp6(1),e.Q6J("ngIf",n.isLoading),e.xp6(2),e.hij(" ",n.isLoading?"Actualizando":"Actualizar"," ")}},dependencies:[h.O5,o._Y,o.JJ,o.JL,o.sg,o.u,E.P]}),s})()}];let Q=(()=>{var r;class s{}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[u.Bz.forChild(B),u.Bz]}),s})();var G=l(6208);let _=(()=>{var r;class s{}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[w],imports:[h.ez,Q,o.UX,G.m]}),s})()}}]);